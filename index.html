<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explorateur de l'Image Numérique</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .mono { font-family: 'Fira Code', monospace; }
        
        /* Animation fluide pour l'apparition des sections */
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen p-4 md:p-8">
    <div class="max-w-6xl mx-auto">
        <!-- Header avec encart illustration -->
        <header class="mb-8 border-b border-slate-200 pb-8 flex flex-col md:flex-row items-center justify-between gap-8">
            <div class="max-w-2xl">
                <h1 class="text-3xl md:text-4xl font-bold text-indigo-700 flex items-center gap-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>
                    Pixel Lab
                </h1>
                <p class="text-slate-600 mt-4 italic text-lg leading-relaxed">
                    Comprendre techniquement comment les algorithmes transforment les pixels, de la capture haute définition à la matrice de données.
                </p>
            </div>
            
            <!-- Encart d'illustration utilisant vignette.png -->
            <div class="relative w-full md:w-64 h-40 md:h-48 rounded-2xl overflow-hidden shadow-lg border-4 border-white flex-shrink-0 bg-indigo-50">
                <img src="vignette.png" alt="Illustration Traitement d'Image" class="w-full h-full object-cover" onerror="this.style.display='none'; this.parentElement.classList.add('flex','items-center','justify-center'); this.parentElement.innerHTML='<span class=\'text-indigo-300 font-bold text-sm\'>vignette.png</span>';">
                <!-- Étiquette -->
                <div class="absolute bottom-2 left-1/2 -translate-x-1/2 bg-white/90 backdrop-blur px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest text-indigo-700 shadow-sm">
                    Illustration
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <div class="flex gap-4 mb-8">
            <button id="btn-intro" onclick="switchTab('intro')" class="px-6 py-2 rounded-lg font-medium transition bg-indigo-600 text-white shadow-md">
                1. Introduction
            </button>
            <button id="btn-lab" onclick="switchTab('lab')" class="px-6 py-2 rounded-lg font-medium transition bg-white text-slate-600 hover:bg-slate-100 border border-slate-200">
                2. Laboratoire Interactif
            </button>
        </div>

        <!-- Section Introduction -->
        <div id="tab-intro" class="grid md:grid-cols-2 gap-8 animate-fade-in">
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
                    Qu'est-ce qu'une image numérique ?
                </h2>
                <div class="space-y-4 text-slate-600 leading-relaxed text-base">
                    <p>
                        Une image numérique est un <strong>tableau de nombres</strong>. Elle est composée de petits carrés appelés <strong>pixels</strong> (Picture Elements).
                    </p>
                    <p>
                        Dans le modèle <strong>RVB (Rouge, Vert, Bleu)</strong>, chaque pixel est défini par trois intensités allant de 0 à 255 :
                    </p>
                    <ul class="list-disc ml-6 space-y-2">
                        <li><span class="text-red-600 font-bold">Rouge</span> : intensité de la lumière rouge.</li>
                        <li><span class="text-green-600 font-bold">Vert</span> : intensité de la lumière verte.</li>
                        <li><span class="text-blue-600 font-bold">Bleu</span> : intensité de la lumière bleue.</li>
                    </ul>
                    <div class="bg-slate-900 text-slate-300 p-4 rounded-xl mono text-sm overflow-x-auto mt-4">
                        // Un pixel blanc pur :<br/>
                        pixel = [255, 255, 255]<br/><br/>
                        // Un pixel noir pur :<br/>
                        pixel = [0, 0, 0]
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
                    Le principe du traitement
                </h2>
                <p class="text-slate-600 mb-4">
                    Traiter une image consiste à appliquer une <strong>fonction mathématique</strong> à chaque pixel. L'ordinateur parcourt l'image ligne par ligne.
                </p>
                <div class="aspect-video bg-indigo-50 rounded-xl border-2 border-dashed border-indigo-200 flex flex-col items-center justify-center p-8 text-center">
                    <div class="grid grid-cols-5 gap-2 mb-4">
                        <div class="w-8 h-8 rounded bg-indigo-400"></div>
                        <div class="w-8 h-8 rounded bg-indigo-400"></div>
                        <div class="w-8 h-8 rounded bg-indigo-600 animate-pulse ring-2 ring-indigo-300"></div>
                        <div class="w-8 h-8 rounded bg-indigo-200"></div>
                        <div class="w-8 h-8 rounded bg-indigo-200"></div>
                    </div>
                    <p class="text-sm font-medium text-indigo-800 uppercase tracking-wide">Traitement matriciel</p>
                </div>
            </div>
        </div>

        <!-- Section Laboratoire -->
        <div id="tab-lab" class="hidden animate-fade-in">
            <div class="grid lg:grid-cols-3 gap-8">
                <!-- Sidebar Controls -->
                <div class="lg:col-span-1 space-y-6">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                        <h3 class="font-bold text-slate-700 mb-4 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                            Source de l'image
                        </h3>
                        <input type="file" id="file-input" class="hidden" accept="image/*">
                        <button onclick="document.getElementById('file-input').click()" class="w-full py-3 px-4 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-xl transition flex items-center justify-center gap-2 border-2 border-dashed border-slate-300 font-medium">
                            Choisir un fichier...
                        </button>
                    </div>

                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                        <h3 class="font-bold text-slate-700 mb-4 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="m12 14 4-4"/><path d="M3.34 19a10 10 0 1 1 17.32 0"/></svg>
                            Algorithmes
                        </h3>
                        <div id="effects-list" class="grid grid-cols-1 gap-2">
                            <!-- Boutons générés par JS -->
                        </div>

                        <div id="threshold-container" class="mt-6 p-4 bg-indigo-50 rounded-xl border border-indigo-100 hidden">
                            <label class="block text-xs font-bold text-indigo-700 uppercase mb-2">Valeur du Seuil: <span id="threshold-val">128</span></label>
                            <input type="range" id="threshold-range" min="0" max="255" value="128" class="w-full accent-indigo-600">
                        </div>
                    </div>
                </div>

                <!-- Canvas Area -->
                <div class="lg:col-span-2 space-y-6">
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 flex flex-col items-center">
                        <div class="w-full flex justify-between items-center mb-4 px-2">
                            <span class="text-xs font-bold text-slate-400 uppercase tracking-widest">Aperçu du rendu</span>
                            <span id="processing-badge" class="hidden text-xs text-indigo-500 font-bold animate-pulse">Calcul...</span>
                        </div>
                        <div class="relative overflow-hidden rounded-lg bg-slate-200 shadow-inner w-full min-h-[300px] flex items-center justify-center border border-slate-200">
                            <canvas id="main-canvas" class="max-w-full h-auto block shadow-2xl"></canvas>
                        </div>
                    </div>

                    <!-- Technical Explanation Card -->
                    <div id="explanation-card" class="bg-slate-900 text-white p-6 rounded-2xl shadow-lg border border-slate-700 transition-all">
                        <div class="flex items-center gap-2 mb-4">
                            <div class="p-2 bg-indigo-500/20 rounded-lg">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-indigo-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
                            </div>
                            <h3 class="text-lg font-semibold tracking-tight" id="effect-title">Algorithme : Original</h3>
                        </div>
                        
                        <p class="text-slate-400 mb-6 leading-relaxed" id="effect-desc">
                            L'image telle qu'elle est enregistrée, une grille de pixels (R, V, B).
                        </p>

                        <div class="space-y-4">
                            <div class="bg-black/50 p-4 rounded-xl border border-white/10">
                                <span class="text-xs font-bold text-indigo-400 uppercase block mb-2">Formule appliquée</span>
                                <code id="effect-formula" class="text-xl mono text-white">Pixel(x,y) = [R, V, B]</code>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="mt-12 text-center text-slate-400 text-sm border-t border-slate-200 pt-8 pb-4">
            <p>Conçu pour l'enseignement des SNT et NSI • Support : Algorithmique & Traitement d'Image</p>
        </footer>
    </div>

    <script>
        const canvas = document.getElementById('main-canvas');
        const ctx = canvas.getContext('2d', { willReadFrequently: true });
        const fileInput = document.getElementById('file-input');
        const effectsList = document.getElementById('effects-list');
        const thresholdContainer = document.getElementById('threshold-container');
        const thresholdRange = document.getElementById('threshold-range');
        const thresholdVal = document.getElementById('threshold-val');
        const badge = document.getElementById('processing-badge');

        let currentImage = null;
        let activeEffect = 'none';

        const effects = {
            none: {
                name: "Original",
                desc: "Aucune modification. Les composantes RVB sont affichées telles quelles.",
                formula: "Pixel(x,y) = [R, V, B]"
            },
            grayscale: {
                name: "Niveaux de Gris",
                desc: "On calcule la moyenne pondérée des composantes pour obtenir la luminance réelle.",
                formula: "Gris = 0.299R + 0.587V + 0.114B"
            },
            negative: {
                name: "Négatif",
                desc: "Inversion de chaque composante par rapport à la valeur maximale (255).",
                formula: "R' = 255 - R, V' = 255 - V, B' = 255 - B"
            },
            threshold: {
                name: "Seuillage",
                desc: "Binarisation de l'image : passage en noir ou blanc pur selon un seuil.",
                formula: "Si Moyenne > Seuil ? 255 : 0"
            },
            mirror: {
                name: "Miroir",
                desc: "Inversion de l'index de colonne des pixels sur l'axe horizontal.",
                formula: "X' = Largeur - 1 - X"
            },
            redChannel: {
                name: "Canal Rouge",
                desc: "Isolation de la composante rouge en neutralisant le vert et le bleu.",
                formula: "Pixel' = [R, 0, 0]"
            }
        };

        function init() {
            Object.keys(effects).forEach(key => {
                const btn = document.createElement('button');
                btn.id = `btn-effect-${key}`;
                btn.className = "effect-btn text-left px-4 py-3 rounded-xl transition flex justify-between items-center bg-slate-50 text-slate-600 hover:bg-slate-100 border border-transparent";
                btn.innerHTML = `
                    <span class="font-medium">${effects[key].name}</span>
                    <div class="indicator w-2 h-2 rounded-full bg-indigo-500 opacity-0 transition"></div>
                `;
                btn.onclick = () => selectEffect(key);
                effectsList.appendChild(btn);
            });

            const defaultImg = new Image();
            defaultImg.crossOrigin = "anonymous";
            defaultImg.src = "https://images.unsplash.com/photo-1579546929518-9e396f3cc809?w=800&q=80";
            defaultImg.onload = () => {
                currentImage = defaultImg;
                if (!document.getElementById('tab-lab').classList.contains('hidden')) {
                    processImage();
                }
            };

            selectEffect('none');
        }

        function switchTab(tab) {
            const intro = document.getElementById('tab-intro');
            const lab = document.getElementById('tab-lab');
            const btnIntro = document.getElementById('btn-intro');
            const btnLab = document.getElementById('btn-lab');

            if (tab === 'intro') {
                intro.className = "grid md:grid-cols-2 gap-8 animate-fade-in";
                lab.className = "hidden animate-fade-in";
                btnIntro.className = "px-6 py-2 rounded-lg font-medium transition bg-indigo-600 text-white shadow-md";
                btnLab.className = "px-6 py-2 rounded-lg font-medium transition bg-white text-slate-600 border border-slate-200";
            } else {
                intro.className = "hidden animate-fade-in";
                lab.className = "block animate-fade-in";
                btnIntro.className = "px-6 py-2 rounded-lg font-medium transition bg-white text-slate-600 border border-slate-200";
                btnLab.className = "px-6 py-2 rounded-lg font-medium transition bg-indigo-600 text-white shadow-md";
                
                if (currentImage) {
                    processImage();
                }
            }
        }

        function selectEffect(key) {
            activeEffect = key;
            document.querySelectorAll('.effect-btn').forEach(b => {
                b.classList.remove('bg-indigo-50', 'text-indigo-700', 'ring-2', 'ring-indigo-200');
                b.querySelector('.indicator').style.opacity = '0';
            });
            const activeBtn = document.getElementById(`btn-effect-${key}`);
            if(activeBtn) {
                activeBtn.classList.add('bg-indigo-50', 'text-indigo-700', 'ring-2', 'ring-indigo-200');
                activeBtn.querySelector('.indicator').style.opacity = '1';
            }

            thresholdContainer.classList.toggle('hidden', key !== 'threshold');
            
            document.getElementById('effect-title').innerText = `Algorithme : ${effects[key].name}`;
            document.getElementById('effect-desc').innerText = effects[key].desc;
            document.getElementById('effect-formula').innerText = effects[key].formula;

            processImage();
        }

        fileInput.onchange = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                const img = new Image();
                img.onload = () => {
                    currentImage = img;
                    if (document.getElementById('tab-lab').classList.contains('hidden')) {
                        switchTab('lab');
                    } else {
                        processImage();
                    }
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        };

        thresholdRange.oninput = (e) => {
            thresholdVal.innerText = e.target.value;
            processImage();
        };

        function processImage() {
            if (!currentImage || !canvas || document.getElementById('tab-lab').classList.contains('hidden')) return;
            
            badge.classList.remove('hidden');

            const maxWidth = 600;
            const scale = Math.min(1, maxWidth / currentImage.width);
            canvas.width = currentImage.width * scale;
            canvas.height = currentImage.height * scale;

            ctx.drawImage(currentImage, 0, 0, canvas.width, canvas.height);
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            const threshold = parseInt(thresholdRange.value);

            if (activeEffect === 'mirror') {
                const temp = new Uint8ClampedArray(data);
                const w = imageData.width;
                const h = imageData.height;
                for (let y = 0; y < h; y++) {
                    for (let x = 0; x < w; x++) {
                        const src = (y * w + x) * 4;
                        const target = (y * w + (w - 1 - x)) * 4;
                        data[target] = temp[src];
                        data[target + 1] = temp[src + 1];
                        data[target + 2] = temp[src + 2];
                        data[target + 3] = temp[src + 3];
                    }
                }
            } else {
                for (let i = 0; i < data.length; i += 4) {
                    const r = data[i];
                    const v = data[i + 1];
                    const b = data[i + 2];

                    switch (activeEffect) {
                        case 'grayscale':
                            const gray = 0.299 * r + 0.587 * v + 0.114 * b;
                            data[i] = data[i + 1] = data[i + 2] = gray;
                            break;
                        case 'negative':
                            data[i] = 255 - r;
                            data[i + 1] = 255 - v;
                            data[i + 2] = 255 - b;
                            break;
                        case 'threshold':
                            const avg = (r + v + b) / 3;
                            const val = avg > threshold ? 255 : 0;
                            data[i] = data[i + 1] = data[i + 2] = val;
                            break;
                        case 'redChannel':
                            data[i + 1] = 0;
                            data[i + 2] = 0;
                            break;
                    }
                }
            }

            ctx.putImageData(imageData, 0, 0);
            badge.classList.add('hidden');
        }

        window.onload = init;
    </script>
</body>
</html>